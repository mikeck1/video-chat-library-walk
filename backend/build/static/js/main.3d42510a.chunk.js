(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{206:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(23),o=n.n(c),i=(n(93),n(94),n(40)),l=n.n(i),u=n(82),s=n(10),m=function(e){var t=e.username,n=e.handleUsernameChange,a=e.roomName,c=e.handleRoomNameChange,o=e.handleSubmit;return r.a.createElement("form",{onSubmit:o},r.a.createElement("h2",null,"Enter a room"),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"name"},"Name:"),r.a.createElement("input",{type:"text",id:"field",value:t,onChange:n,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"room"},"Room name:"),r.a.createElement("input",{type:"text",id:"room",value:a,onChange:c,required:!0}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Submit")))},f=n(13),d=n(83),p=n.n(d),b=function(e){var t=e.participant,n=Object(a.useState)([]),c=Object(s.a)(n,2),o=c[0],i=c[1],l=Object(a.useState)([]),u=Object(s.a)(l,2),m=u[0],d=u[1],p=Object(a.useRef)(),b=Object(a.useRef)(),h=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(a.useEffect)((function(){i(h(t.videoTracks)),d(h(t.audioTracks));return t.on("trackSubscribed",(function(e){"video"===e.kind?i((function(t){return[].concat(Object(f.a)(t),[e])})):d((function(t){return[].concat(Object(f.a)(t),[e])}))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?i((function(t){return t.filter((function(t){return t!==e}))})):d((function(t){return t.filter((function(t){return t!==e}))}))})),function(){i([]),d([]),t.removeAllListeners()}}),[t]),Object(a.useEffect)((function(){var e=o[0];if(e)return e.attach(p.current),function(){e.detach()}}),[o]),Object(a.useEffect)((function(){var e=m[0];if(e)return e.attach(b.current),function(){e.detach()}}),[m]),r.a.createElement("div",{className:"participant"},r.a.createElement("h3",null,t.identity),r.a.createElement("video",{ref:p,autoPlay:!0}),r.a.createElement("audio",{ref:b,autoPlay:!0}))},h=function(e){var t=e.roomName,n=e.token,c=e.handleLogout,o=Object(a.useState)(null),i=Object(s.a)(o,2),l=i[0],u=i[1],m=Object(a.useState)([]),d=Object(s.a)(m,2),h=d[0],v=d[1];Object(a.useEffect)((function(){var e=function(e){v((function(t){return[].concat(Object(f.a)(t),[e])}))},a=function(e){v((function(t){return t.filter((function(t){return t!==e}))}))};return p.a.connect(n,{name:t}).then((function(t){u(t),t.on("participantConnected",e),t.on("participantDisconnected",a),t.participants.forEach(e)})),function(){u((function(e){return e&&"connected"===e.localParticipant.state?(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect(),null):e}))}}),[t,n]);var E=h.map((function(e){return r.a.createElement(b,{key:e.sid,participant:e})}));return r.a.createElement("div",{className:"room"},r.a.createElement("h2",null,"Room: ",t),r.a.createElement("button",{onClick:c},"Log out"),r.a.createElement("div",{className:"local-participant"},l?r.a.createElement(b,{key:l.localParticipant.sid,participant:l.localParticipant}):""),r.a.createElement("h3",null,"Remote Participants"),r.a.createElement("div",{className:"remote-participants"},E))},v=function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),i=Object(s.a)(o,2),f=i[0],d=i[1],p=Object(a.useState)(null),b=Object(s.a)(p,2),v=b[0],E=b[1],g=Object(a.useCallback)((function(e){c(e.target.value)}),[]),O=Object(a.useCallback)((function(e){d(e.target.value)}),[]),j=Object(a.useCallback)(function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/api/video/token",{method:"POST",body:JSON.stringify({identity:n,room:f}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:a=e.sent,E(a.token);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,n]),k=Object(a.useCallback)((function(e){E(null)}),[]);return v?r.a.createElement(h,{roomName:f,token:v,handleLogout:k}):r.a.createElement(m,{username:n,roomName:f,handleUsernameChange:g,handleRoomNameChange:O,handleSubmit:j})},E=n(25),g=n(26),O=n(29),j=n(28),k=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={message:""},e}return Object(g.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{action:".",onSubmit:function(t){t.preventDefault(),e.props.onSubmitMessage(e.state.message),e.setState({message:""})}},r.a.createElement("input",{type:"text",placeholder:"Enter message...",value:this.state.message,onChange:function(t){return e.setState({message:t.target.value})}}),r.a.createElement("input",{type:"submit",value:"Send"}))}}]),n}(a.Component),y=function(e){var t=e.name,n=e.message;return r.a.createElement("p",null,r.a.createElement("strong",null,t)," ",r.a.createElement("em",null,n))},S="ws://localhost:3030",w=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={name:"Bob",messages:[]},e.ws=new WebSocket(S),e.addMessage=function(t){return e.setState((function(e){return{messages:[t].concat(Object(f.a)(e.messages))}}))},e.submitMessage=function(t){var n={name:e.state.name,message:t};e.ws.send(JSON.stringify(n)),e.addMessage(n)},e}return Object(g.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.ws.onopen=function(){console.log("connected")},this.ws.onmessage=function(t){var n=JSON.parse(t.data);e.addMessage(n)},this.ws.onclose=function(){console.log("disconnected"),e.setState({ws:new WebSocket(S)})}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"name"},"Name:\xa0",r.a.createElement("input",{type:"text",id:"name",placeholder:"Enter your name...",value:this.state.name,onChange:function(t){return e.setState({name:t.target.value})}})),r.a.createElement(k,{ws:this.ws,onSubmitMessage:function(t){return e.submitMessage(t)}}),this.state.messages.map((function(e,t){return r.a.createElement(y,{key:t,message:e.message,name:e.name})})))}}]),n}(a.Component),C=(n(202),n(209)),N=function(){return r.a.createElement("div",{className:"app"},r.a.createElement(C.a,{bg:"dark",variant:"dark"},r.a.createElement(C.a.Brand,{href:"#home"},"Library Walk"),r.a.createElement(C.a.Toggle,null),r.a.createElement(C.a.Collapse,{className:"justify-content-end"},r.a.createElement(C.a.Text,null,"Signed in as: ",r.a.createElement("a",{href:"#login"},"Mark Otto")))),r.a.createElement("main",null,r.a.createElement("div",{style:{backgroundColor:"lightblue",width:"100%",textAlign:"center",top:0,position:"relative"}},r.a.createElement(v,null),r.a.createElement(w,null))),r.a.createElement("footer",null,r.a.createElement("p",null,"Made with"," ",r.a.createElement("span",{role:"img","aria-label":"React"},"\u269b\ufe0f")," ","by M^3 and C")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},88:function(e,t,n){e.exports=n(206)},93:function(e,t,n){},94:function(e,t,n){}},[[88,1,2]]]);
//# sourceMappingURL=main.3d42510a.chunk.js.map